# Zaim API Client テストシナリオ

## 1. 認証テスト

### 1.1 正常認証テスト
- **目的**: OAuth 1.0a認証が正常に動作することを確認
- **前提条件**: 有効な認証情報が設定されている
- **手順**:
  1. ZaimClientを初期化
  2. verify_user()を実行
  3. ユーザー情報が正常に取得できることを確認
- **期待結果**: ユーザー名、入力回数等の情報が返される

### 1.2 認証情報不正テスト
- **目的**: 不正な認証情報でのエラーハンドリングを確認
- **前提条件**: 無効な認証情報
- **手順**:
  1. 不正な認証情報でZaimClientを初期化
  2. verify_user()を実行
  3. 適切なエラーが発生することを確認
- **期待結果**: 認証エラーが発生する

### 1.3 環境変数未設定テスト
- **目的**: 認証情報が未設定時のエラーハンドリングを確認
- **前提条件**: 環境変数が未設定
- **手順**:
  1. 認証情報なしでZaimClientを初期化
  2. ValueErrorが発生することを確認
- **期待結果**: "OAuth credentials are required"エラー

## 2. マスターデータ取得テスト

### 2.1 カテゴリ取得テスト
- **目的**: ユーザーのカテゴリ一覧が取得できることを確認
- **手順**:
  1. get_categories()を実行
  2. カテゴリリストが返されることを確認
  3. 各カテゴリにid, name, modeが含まれることを確認

### 2.2 ジャンル取得テスト
- **目的**: ユーザーのジャンル一覧が取得できることを確認
- **手順**:
  1. get_genres()を実行
  2. ジャンルリストが返されることを確認
  3. 各ジャンルにid, name, category_idが含まれることを確認

### 2.3 アカウント取得テスト
- **目的**: ユーザーのアカウント一覧が取得できることを確認
- **手順**:
  1. get_accounts()を実行
  2. アカウントリストが返されることを確認
  3. 各アカウントにid, nameが含まれることを確認

### 2.4 デフォルトマスターデータ取得テスト
- **目的**: デフォルトのカテゴリ・ジャンル・アカウント情報が取得できることを確認
- **手順**:
  1. get_default_categories()を実行
  2. get_default_genres()を実行
  3. get_default_accounts()を実行
  4. get_currencies()を実行
- **期待結果**: 各マスターデータが正常に取得される

## 3. 家計簿データCRUD操作テスト

### 3.1 支出データ作成テスト
- **目的**: 支出データが正常に作成できることを確認
- **手順**:
  1. 有効なカテゴリIDとジャンルIDを取得
  2. create_payment()で支出データを作成
  3. 作成されたデータのIDが返されることを確認
- **テストデータ**: 
  - 金額: 500円
  - 日付: 今日
  - コメント: "テスト支出"

### 3.2 収入データ作成テスト
- **目的**: 収入データが正常に作成できることを確認
- **手順**:
  1. 有効な収入カテゴリIDを取得
  2. create_income()で収入データを作成
  3. 作成されたデータのIDが返されることを確認
- **テストデータ**:
  - 金額: 10000円
  - 日付: 今日
  - コメント: "テスト収入"

### 3.3 振替データ作成テスト
- **目的**: 振替データが正常に作成できることを確認
- **前提条件**: 2つ以上のアカウントが存在する
- **手順**:
  1. 2つのアカウントIDを取得
  2. create_transfer()で振替データを作成
  3. 作成されたデータのIDが返されることを確認
- **テストデータ**:
  - 金額: 5000円
  - 日付: 今日
  - コメント: "テスト振替"

### 3.4 データ取得テスト
- **目的**: 家計簿データが正常に取得できることを確認
- **手順**:
  1. get_money()でデータ取得
  2. 取得したデータの構造を確認
  3. ページングパラメータのテスト
  4. フィルタリングパラメータのテスト

### 3.5 データ更新テスト
- **目的**: 既存データが正常に更新できることを確認
- **前提条件**: 更新対象のデータが存在する
- **手順**:
  1. テスト用データを作成
  2. update_money()でデータ更新
  3. 更新が正常に反映されることを確認

### 3.6 データ削除テスト
- **目的**: データが正常に削除できることを確認
- **前提条件**: 削除対象のデータが存在する
- **手順**:
  1. テスト用データを作成
  2. delete_money()でデータ削除
  3. データが削除されることを確認

## 4. エラーハンドリングテスト

### 4.1 必須パラメータ不足テスト
- **目的**: 必須パラメータが不足している場合のエラーハンドリングを確認
- **手順**:
  1. 必須パラメータを省略してAPIを実行
  2. 適切なエラーメッセージが返されることを確認

### 4.2 不正パラメータテスト
- **目的**: 不正な値が設定された場合のエラーハンドリングを確認
- **手順**:
  1. 存在しないカテゴリIDを指定
  2. 不正な日付形式を指定
  3. 文字数制限を超えるコメントを指定

### 4.3 ネットワークエラーテスト
- **目的**: ネットワークエラー時の動作を確認
- **手順**:
  1. 不正なエンドポイントURLを設定
  2. APIリクエストを実行
  3. 適切なエラーハンドリングが行われることを確認

### 4.4 APIレスポンスエラーテスト
- **目的**: APIサーバーからのエラーレスポンス処理を確認
- **手順**:
  1. 400, 401, 404エラーを発生させる条件を作成
  2. 各エラーが適切に処理されることを確認

## 5. 境界値・制限値テスト

### 5.1 金額制限テスト
- **目的**: 金額の最大値・最小値での動作を確認
- **テストケース**:
  - 金額: 0円
  - 金額: 999999999円（大きな値）
  - 金額: -1円（負の値）

### 5.2 文字数制限テスト
- **目的**: コメント・名前・場所の文字数制限を確認
- **テストケース**:
  - 100文字のコメント（上限値）
  - 101文字のコメント（上限超過）
  - 空文字列

### 5.3 日付制限テスト
- **目的**: 日付の有効範囲を確認
- **テストケース**:
  - 過去5年前の日付
  - 未来5年後の日付
  - 無効な日付形式

### 5.4 ページング制限テスト
- **目的**: ページングパラメータの制限を確認
- **テストケース**:
  - limit: 1（最小値）
  - limit: 100（最大値）
  - limit: 101（最大値超過）
  - page: 0（無効値）

## 6. 実行環境・設定テスト

### 6.1 .envファイルテスト
- **目的**: .envファイルからの設定読み込みが正常に動作することを確認
- **手順**:
  1. .envファイルに認証情報を設定
  2. ZaimClientを初期化
  3. 認証が正常に行われることを確認

### 6.2 直接パラメータ指定テスト
- **目的**: コンストラクタへの直接パラメータ指定が動作することを確認
- **手順**:
  1. 環境変数を設定せず、コンストラクタで認証情報を指定
  2. ZaimClientを初期化
  3. 認証が正常に行われることを確認

## 7. 統合テストシナリオ

### 7.1 実際の家計簿入力フローテスト
- **目的**: 実際の使用シナリオでの動作確認
- **シナリオ**: 
  1. ユーザー認証
  2. マスターデータ取得
  3. 今日の朝食代を支出として登録
  4. バイト代を収入として登録
  5. 銀行から財布への現金引き出しを振替として登録
  6. 今月の家計簿データを取得・確認
- **期待結果**: すべての操作が正常に完了する

### 7.2 エラーリカバリーテスト
- **目的**: エラー発生時の適切な処理とリカバリー
- **シナリオ**:
  1. 不正な認証情報でエラー発生
  2. 正しい認証情報に修正して再試行
  3. 正常に処理が完了することを確認

## テスト実行方法

1. **事前準備**:
   ```bash
   pip install -r requirements.txt
   cp .env.example .env
   # .envファイルに実際の認証情報を設定
   ```

2. **個別テスト実行**:
   ```bash
   python test_auth.py
   python test_master_data.py
   python test_crud.py
   python test_error_handling.py
   ```

3. **統合テスト実行**:
   ```bash
   python test_integration.py
   ```

4. **全テスト実行**:
   ```bash
   python run_all_tests.py
   ```